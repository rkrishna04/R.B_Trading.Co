<!DOCTYPE html>
<html lang="gu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RB Trading Co. - Bodeli</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Hind+Vadodara:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --dark-green: #1a472a; --card-red: #d32f2f; --bg-cream: #fdfaf5; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Hind Vadodara', sans-serif; background-color: var(--bg-cream); color: #333; padding-bottom: 100px; }
        header { background: white; padding: 20px 15px; text-align: center; border-bottom: 4px solid var(--dark-green); box-shadow: 0 2px 5px rgba(0,0,0,0.1); position: relative; }
        .brand-title { color: var(--card-red); font-size: 30px; font-weight: 800; line-height: 1.2; }
        .profile-box { display: flex; align-items: center; background: white; margin: 15px; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .profile-box img { width: 85px; height: 85px; border: 2px solid var(--dark-green); border-radius: 4px; object-fit: cover; }
        .profile-details { margin-left: 15px; }
        .price-highlight { background: var(--dark-green); color: white; margin: 15px; padding: 20px; border-radius: 4px; text-align: center; border-left: 10px solid #ffd700; }
        .big-rate { font-size: 42px; font-weight: 800; color: #ffd700; margin: 5px 0; }
        .history-section { margin: 15px; background: white; border: 1px solid #ccc; }
        .history-title { background: #eee; padding: 10px; font-weight: 700; border-bottom: 2px solid var(--dark-green); text-align: center; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px 8px; text-align: center; border-bottom: 1px solid #eee; font-size: 15px; }
        .price-text { font-weight: 700; color: var(--dark-green); }
        .action-btns { position: fixed; bottom: 0; width: 100%; display: flex; padding: 10px; background: white; gap: 10px; box-shadow: 0 -3px 10px rgba(0,0,0,0.1); }
        .btn { flex: 1; padding: 15px 5px; text-align: center; text-decoration: none; color: white; font-weight: 700; border-radius: 6px; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-phone { background: var(--dark-green); flex: 0.4; }
        .btn-whatsapp { background: #25D366; flex: 1; }
        
        /* Admin UI */
        #admin-panel { display: none; background: #fff; margin: 15px; padding: 15px; border: 2px dashed var(--dark-green); border-radius: 8px; }
        .admin-input { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ccc; border-radius: 4px; }
    </style>
</head>
<body>

<header>
    <div class="brand-title">ркЖрк░.ркмрлА. ркЯрлНрк░рлЗркбрк┐ркВркЧ ркХрк╛рлБркВ.</div>
    <div style="font-weight: 600; color: #555;">ркорк╛рк░рлНркХрлЗркЯ ркпрк╛рк░рлНркб, ркмрлЛркбрлЗрк▓рлА</div>
    <i class="fas fa-lock" onclick="checkAdmin()" style="position: absolute; right: 20px; top: 25px; color: #ccc; cursor: pointer;"></i>
</header>

<div id="admin-panel">
    <h3 style="color: var(--dark-green); margin-bottom: 10px;">ЁЯЫая╕П ркнрк╛рк╡ ркЕрккркбрлЗркЯ ркХрк░рлЛ</h3>
    <input type="number" id="new-kapas" class="admin-input" placeholder="ркХрккрк╛рк╕ркирлЛ ркирк╡рлЛ ркнрк╛рк╡">
    <input type="number" id="new-magfali" class="admin-input" placeholder="ркоркЧрклрк│рлАркирлЛ ркирк╡рлЛ ркнрк╛рк╡">
    <button onclick="submitPrice()" style="width: 100%; padding: 12px; background: var(--dark-green); color: white; border: none; border-radius: 4px; font-weight: bold; cursor: pointer;">Update Now</button>
</div>

<div class="price-highlight">
    <h3 id="current-date-label">ркЖркЬркирлЛ ркХрккрк╛рк╕ркирлЛ ркнрк╛рк╡ (рлирлж ркХрк┐рк▓рлЛ)</h3>
    <div class="big-rate" id="today-kapas">тВ╣ ...</div>
    <div style="font-size: 13px;" id="update-time">ркЕрккркбрлЗркЯ ркеркИ рк░рк╣рлНркпрлБркВ ркЫрлЗ...</div>
</div>

<div class="history-section">
    <div class="history-title">ЁЯУЕ ркЫрлЗрк▓рлНрк▓рк╛ ркнрк╛рк╡ркирлА ркорк╛рк╣рк┐ркдрлА</div>
    <table>
        <thead>
            <tr><th>ркдрк╛рк░рлАркЦ</th><th>ркХрккрк╛рк╕</th><th>ркоркЧрклрк│рлА</th></tr>
        </thead>
        <tbody id="history-table-body">
            </tbody>
    </table>
</div>

<div class="action-btns">
    <a href="tel:9825793229" class="btn btn-phone">ЁЯУЮ рклрлЛрки</a>
    <a href="https://wa.me/919825793226" class="btn btn-whatsapp"><i class="fab fa-whatsapp"></i> ркорк╛рк╣рк┐ркдрлА ркорк╛ркЯрлЗ ркЬрлЛркбрк╛рк╡рлЛ</a>
</div>

<script>
const ADMIN_PASS = "RB@2025";

// ркПркбркорк┐рки ркЪрлЗркХ ркХрк░рк╡рк╛ ркорк╛ркЯрлЗ
function checkAdmin() {
    const p = prompt("рккрк╛рк╕рк╡рк░рлНркб ркирк╛ркЦрлЛ:");
    if (p === ADMIN_PASS) {
        document.getElementById('admin-panel').style.display = 'block';
    } else {
        alert("ркЦрлЛркЯрлЛ рккрк╛рк╕рк╡рк░рлНркб!");
    }
}

// ркбрлЗркЯрк╛ рк▓рлЛркб ркХрк░рк╡рк╛ ркорк╛ркЯрлЗ
async function loadData() {
    try {
        const res = await fetch('/api/db');
        const data = await res.json();
        
        if (data.prices && data.prices.length > 0) {
            const latest = data.prices[0];
            document.getElementById('today-kapas').innerText = "тВ╣ " + latest.kapas;
            document.getElementById('update-time').innerText = "ркЕрккркбрлЗркЯ: " + latest.date_text;
            
            let html = "";
            data.prices.forEach(row => {
                html += `<tr><td>${row.date_text}</td><td class="price-text">${row.kapas}</td><td>${row.magfali}</td></tr>`;
            });
            document.getElementById('history-table-body').innerHTML = html;
        }
    } catch (e) { console.error("Load error", e); }
}

// ркнрк╛рк╡ рк╕ркмркорк┐ркЯ ркХрк░рк╡рк╛
async function submitPrice() {
    const k = document.getElementById('new-kapas').value;
    const m = document.getElementById('new-magfali').value;
    
    if(!k || !m) return alert("ркмркВркирлЗ ркнрк╛рк╡ ркирк╛ркЦрлЛ");

    const res = await fetch('/api/db', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ kapas: k, magfali: m })
    });

    if(res.ok) {
        alert("ркнрк╛рк╡ рк╕рклрк│ркдрк╛рккрлВрк░рлНрк╡ркХ ркмркжрк▓рк╛ркИ ркЧркпрк╛!");
        location.reload();
    }
}

window.onload = loadData;
</script>
</body>
</html>
